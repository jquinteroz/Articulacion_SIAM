{% extends "admin/base_admin.html" %}

{% block title %}{{ 'Editar' if action == 'editar' else 'Crear' }} Grupo - Admin{% endblock %}

{% block content %}

<!-- Header con gradiente SENA -->
<div class="bg-gradient-to-r from-sena-green to-sena-green-dark text-white rounded-xl md:rounded-2xl shadow-lg p-4 md:p-8 mb-6 md:mb-8">
    <nav class="flex items-center gap-2 text-xs md:text-sm mb-2 md:mb-3 text-white/90">
        <a href="{{ url_for('admin.dashboard') }}" class="hover:text-white transition-colors">
            <i class="fas fa-home"></i> Inicio
        </a>
        <span>/</span>
        <a href="{{ url_for('admin.grupos') }}" class="hover:text-white transition-colors">
            Grupos
        </a>
        <span>/</span>
        <span class="font-semibold text-white">{{ 'Editar' if action == 'editar' else 'Crear' }}</span>
    </nav>
    <h1 class="text-2xl md:text-3xl font-bold flex items-center gap-2 md:gap-3 mb-2">
        <div class="w-10 h-10 md:w-12 md:h-12 bg-white/20 rounded-lg md:rounded-xl flex items-center justify-center">
            <i class="fas fa-{{ 'edit' if action == 'editar' else 'plus' }}"></i>
        </div>
        {{ 'Editar' if action == 'editar' else 'Crear Nuevo' }} Grupo
    </h1>
    <p class="text-white/95 text-sm md:text-lg">
        {{ 'Modifique la información del grupo' if action == 'editar' else 'Complete la información para crear un nuevo grupo' }}
    </p>
</div>

<form method="POST">
    <!-- Información del Grupo -->
    <div class="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6 md:mb-8 border-2 border-gray-100">
        <div class="bg-gradient-to-r from-sena-green to-sena-green-dark px-4 md:px-6 py-3 md:py-4 flex items-center">
            <div class="w-8 h-8 md:w-10 md:h-10 bg-white/20 rounded-lg flex items-center justify-center mr-2 md:mr-3">
                <i class="fas fa-info-circle text-white text-sm md:text-base"></i>
            </div>
            <h3 class="text-base md:text-xl font-bold text-white">Información del Grupo</h3>
        </div>
        <div class="p-4 md:p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <!-- Número del Grupo -->
                <div class="md:col-span-2">
                    <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-2" for="nombre">
                        <i class="fas fa-hashtag text-sena-green mr-1"></i> Número del Grupo *
                    </label>
                    <input type="text"
                           class="w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border-2 border-gray-300 rounded-lg md:rounded-xl focus:outline-none focus:ring-2 focus:ring-sena-green focus:border-transparent transition-all"
                           id="nombre"
                           name="nombre"
                           value="{{ grupo.nombre if grupo else '' }}"
                           placeholder="Ej: 2345678, 2345679"
                           pattern="[0-9]+"
                           required>
                    <small class="text-gray-600 text-xs md:text-sm mt-1 block">Ingrese el número identificador del grupo (solo dígitos). Este número será generado por el administrador y asociado a un programa de formación.</small>
                </div>

                <!-- Colegio -->
                <div>
                    <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-2" for="colegio_id">
                        <i class="fas fa-school text-sena-green mr-1"></i> Colegio *
                    </label>
                    <select class="w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border-2 border-gray-300 rounded-lg md:rounded-xl focus:outline-none focus:ring-2 focus:ring-sena-green focus:border-transparent transition-all bg-white" 
                            id="colegio_id" 
                            name="colegio_id" 
                            required>
                        <option value="">-- Seleccione un colegio --</option>
                        {% for colegio in colegios %}
                        <option value="{{ colegio.id }}"
                                {% if grupo and grupo.colegio_id == colegio.id %}selected{% endif %}>
                            {{ colegio.nombre }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Programa -->
                <div>
                    <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-2" for="programa_id">
                        <i class="fas fa-graduation-cap text-sena-green mr-1"></i> Programa *
                    </label>
                    <select class="w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border-2 border-gray-300 rounded-lg md:rounded-xl focus:outline-none focus:ring-2 focus:ring-sena-green focus:border-transparent transition-all bg-white" 
                            id="programa_id" 
                            name="programa_id" 
                            required>
                        <option value="">-- Seleccione un programa --</option>
                        {% for programa in programas %}
                        <option value="{{ programa.id }}"
                                {% if grupo and grupo.programa_id == programa.id %}selected{% endif %}>
                            {{ programa.nombre }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Jornada -->
                <div>
                    <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-2" for="jornada">
                        <i class="fas fa-clock text-sena-green mr-1"></i> Jornada *
                    </label>
                    <select class="w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border-2 border-gray-300 rounded-lg md:rounded-xl focus:outline-none focus:ring-2 focus:ring-sena-green focus:border-transparent transition-all bg-white" 
                            id="jornada" 
                            name="jornada" 
                            required>
                        <option value="">-- Seleccione una jornada --</option>
                        <option value="MAÑANA" {% if grupo and grupo.jornada == 'MAÑANA' %}selected{% endif %}>Mañana</option>
                        <option value="TARDE" {% if grupo and grupo.jornada == 'TARDE' %}selected{% endif %}>Tarde</option>
                        <option value="NOCHE" {% if grupo and grupo.jornada == 'NOCHE' %}selected{% endif %}>Noche</option>
                        <option value="UNICA" {% if grupo and grupo.jornada == 'UNICA' %}selected{% endif %}>Única</option>
                    </select>
                </div>

                <!-- Año Lectivo -->
                <div>
                    <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-2" for="año_lectivo">
                        <i class="fas fa-calendar-alt text-sena-green mr-1"></i> Año Lectivo *
                    </label>
                    <input type="number"
                           class="w-full px-3 md:px-4 py-2 md:py-3 text-sm md:text-base border-2 border-gray-300 rounded-lg md:rounded-xl focus:outline-none focus:ring-2 focus:ring-sena-green focus:border-transparent transition-all"
                           id="año_lectivo"
                           name="año_lectivo"
                           value="{{ grupo.año_lectivo if grupo else 2025 }}"
                           min="2020"
                           max="2099"
                           required>
                </div>

                <!-- Estado (solo al editar) -->
                {% if action == 'editar' %}
                <div class="md:col-span-2">
                    <div class="flex items-center gap-3 md:gap-4 p-3 md:p-4 bg-gray-50 rounded-lg md:rounded-xl border-2 border-gray-200">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox"
                                   id="activo"
                                   name="activo"
                                   class="sr-only peer"
                                   {% if grupo.activo %}checked{% endif %}>
                            <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-sena-green/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-sena-green"></div>
                        </label>
                        <div>
                            <div class="font-semibold text-gray-800 text-sm md:text-base flex items-center gap-2">
                                <i class="fas fa-check-circle text-sena-green"></i> Grupo Activo
                            </div>
                            <small class="text-gray-600 text-xs md:text-sm">Los grupos inactivos no aparecerán en los selectores del sistema</small>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Información Importante -->
    <div class="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6 md:mb-8 border-2 border-gray-100">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-4 md:px-6 py-3 md:py-4 flex items-center">
            <div class="w-8 h-8 md:w-10 md:h-10 bg-white/20 rounded-lg flex items-center justify-center mr-2 md:mr-3">
                <i class="fas fa-info-circle text-white text-sm md:text-base"></i>
            </div>
            <h3 class="text-base md:text-xl font-bold text-white">Información Importante</h3>
        </div>
        <div class="p-4 md:p-6 space-y-3 md:space-y-4">
            <!-- Número del Grupo -->
            <div class="flex gap-3 md:gap-4 p-3 md:p-4 bg-yellow-50 rounded-lg md:rounded-xl border-2 border-yellow-200">
                <i class="fas fa-lightbulb text-yellow-600 text-lg md:text-2xl flex-shrink-0 mt-1"></i>
                <div>
                    <strong class="text-gray-800 text-sm md:text-base block mb-1">Número del Grupo</strong>
                    <p class="text-gray-700 text-xs md:text-sm">El número del grupo es generado por el administrador y debe contener solo dígitos. Ejemplo: 2345678, 2345679</p>
                </div>
            </div>

            <!-- Asociación con Programa -->
            <div class="flex gap-3 md:gap-4 p-3 md:p-4 bg-blue-50 rounded-lg md:rounded-xl border-2 border-blue-200">
                <i class="fas fa-link text-blue-600 text-lg md:text-2xl flex-shrink-0 mt-1"></i>
                <div>
                    <strong class="text-gray-800 text-sm md:text-base block mb-1">Asociación con Programa</strong>
                    <p class="text-gray-700 text-xs md:text-sm">Cada grupo debe estar asociado a un colegio y a un programa de formación específico. Los aprendices seleccionarán este grupo al matricularse.</p>
                </div>
            </div>

            <!-- Aprendices -->
            <div class="flex gap-3 md:gap-4 p-3 md:p-4 bg-green-50 rounded-lg md:rounded-xl border-2 border-green-200">
                <i class="fas fa-users text-sena-green text-lg md:text-2xl flex-shrink-0 mt-1"></i>
                <div>
                    <strong class="text-gray-800 text-sm md:text-base block mb-1">Aprendices</strong>
                    <p class="text-gray-700 text-xs md:text-sm">Los aprendices podrán seleccionar este grupo al completar su matrícula</p>
                </div>
            </div>

            <!-- Advertencia (solo en edición con aprendices) -->
            {% if action == 'editar' and grupo.aprendices|length > 0 %}
            <div class="flex gap-3 md:gap-4 p-3 md:p-4 bg-red-50 rounded-lg md:rounded-xl border-2 border-red-200">
                <i class="fas fa-exclamation-triangle text-red-600 text-lg md:text-2xl flex-shrink-0 mt-1"></i>
                <div>
                    <strong class="text-gray-800 text-sm md:text-base block mb-1">Advertencia</strong>
                    <p class="text-gray-700 text-xs md:text-sm">Este grupo tiene {{ grupo.aprendices|length }} aprendiz(es) asociado(s). No puede ser eliminado.</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Botones de Acción -->
    <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 md:gap-4 p-4 md:p-6 bg-gray-50 rounded-xl md:rounded-2xl border-2 border-gray-200">
        <a href="{{ url_for('admin.grupos') }}" class="inline-flex items-center justify-center px-6 py-3 bg-white border-2 border-gray-300 rounded-lg md:rounded-xl font-semibold text-sm md:text-base text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 shadow-sm">
            <i class="fas fa-times mr-2"></i>
            Cancelar
        </a>
        <button type="submit" class="inline-flex items-center justify-center px-8 py-3 bg-gradient-to-r from-sena-green to-sena-green-dark hover:from-sena-green-dark hover:to-sena-green-darker text-white font-bold text-sm md:text-base rounded-lg md:rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
            <i class="fas fa-save mr-2"></i>
            {{ 'Actualizar' if action == 'editar' else 'Crear' }} Grupo
        </button>
    </div>
</form>

{% endblock %}
