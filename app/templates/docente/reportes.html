{% extends "docente/base_docente.html" %}

{% block title %}Reportes - Docente Enlace{% endblock %}

{% block content %}

<!-- Modern Header -->
<div class="reports-modern-header">
    <div class="reports-header-content">
        <div class="reports-header-left">
            <nav class="reports-breadcrumb">
                <a href="{{ url_for('docente.dashboard') }}" class="breadcrumb-link">
                    <i class="fas fa-home"></i> Inicio
                </a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Reportes</span>
            </nav>
            <h1 class="reports-main-title">
                <i class="fas fa-chart-bar"></i> Reportes y Estad√≠sticas
            </h1>
            <p class="reports-subtitle">Genere y descargue reportes de matr√≠culas y aprendices de {{ colegio.nombre }}</p>
        </div>
        <div class="reports-header-icon">
            <i class="fas fa-file-chart-line"></i>
        </div>
    </div>
</div>

<!-- Stats Cards Row -->
<div class="reports-stats-grid">
    <div class="reports-stat-card stat-blue">
        <div class="stat-icon-wrapper">
            <div class="stat-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.total }}</div>
            <div class="stat-label">Total Matr√≠culas</div>
        </div>
        <div class="stat-trend">
            <i class="fas fa-chart-line"></i>
        </div>
    </div>

    <div class="reports-stat-card stat-orange">
        <div class="stat-icon-wrapper">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.pendientes }}</div>
            <div class="stat-label">Pendientes</div>
        </div>
        <div class="stat-trend">
            <i class="fas fa-exclamation-circle"></i>
        </div>
    </div>

    <div class="reports-stat-card stat-green">
        <div class="stat-icon-wrapper">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.completas }}</div>
            <div class="stat-label">Completas</div>
        </div>
        <div class="stat-trend">
            <i class="fas fa-thumbs-up"></i>
        </div>
    </div>

    <div class="reports-stat-card stat-purple">
        <div class="stat-icon-wrapper">
            <div class="stat-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
        </div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.prematriculas }}</div>
            <div class="stat-label">Pre-matr√≠culas</div>
        </div>
        <div class="stat-trend">
            <i class="fas fa-star"></i>
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="reports-content-grid">
    <!-- Filters Panel -->
    <div class="reports-filters-panel">
        <div class="modern-card">
            <div class="modern-card-header">
                <div class="card-header-icon">
                    <i class="fas fa-sliders-h"></i>
                </div>
                <h3 class="card-header-title">Filtros de Reporte</h3>
            </div>
            <div class="modern-card-body">
                <form method="POST" action="{{ url_for('docente.generar_reporte_pdf') }}" id="reporteForm">
                    <!-- Tipo de Reporte -->
                    <div class="modern-form-group">
                        <label class="modern-label">
                            <i class="fas fa-clipboard-list label-icon"></i>
                            Tipo de Reporte
                        </label>
                        <select name="filtro_tipo" id="filtro_tipo" class="modern-select" required>
                            <option value="">-- Seleccione un tipo --</option>
                            <option value="matriculas">üìä Matr√≠culas por Estado</option>
                            <option value="programa">üéì Matr√≠culas por Programa</option>
                            <option value="grupo">üë• Matr√≠culas por Grupo</option>
                            <option value="documentos">üìÑ Estado de Documentos</option>
                            <option value="sofia">üüß Formato SENA (SOFIA Plus)</option>
                            <option value="completo">üìë Reporte Completo</option>
                        </select>
                    </div>

                    <!-- Filtro por Programa -->
                    <div class="modern-form-group">
                        <label class="modern-label">
                            <i class="fas fa-graduation-cap label-icon"></i>
                            Programa
                        </label>
                        <select name="programa_id" id="programa_id" class="modern-select">
                            <option value="">Todos los programas</option>
                            {% for programa in programas %}
                            <option value="{{ programa.id }}">{{ programa.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Filtro por Grupo -->
                    <div class="modern-form-group">
                        <label class="modern-label">
                            <i class="fas fa-users label-icon"></i>
                            Grupo
                        </label>
                        <select name="grupo_id" id="grupo_id" class="modern-select">
                            <option value="">Todos los grupos</option>
                            {% for grupo in grupos %}
                            <option value="{{ grupo.id }}">{{ grupo.nombre }} - {{ grupo.programa.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Filtro por Estado -->
                    <div class="modern-form-group">
                        <label class="modern-label">
                            <i class="fas fa-flag label-icon"></i>
                            Estado
                        </label>
                        <select name="estado" id="estado" class="modern-select">
                            <option value="">Todos los estados</option>
                            <option value="BORRADOR">Borrador</option>
                            <option value="ENVIADO">Enviado</option>
                            <option value="PENDIENTE">Pendiente</option>
                            <option value="COMPLETO">Completo</option>
                            <option value="PREMATRICULA">Pre-matr√≠cula</option>
                            <option value="MATRICULADO">Matriculado</option>
                        </select>
                    </div>

                    <!-- Rango de Fechas -->
                    <div class="modern-form-group">
                        <label class="modern-label">
                            <i class="fas fa-calendar-alt label-icon"></i>
                            Rango de Fechas
                        </label>
                        <div class="date-range-inputs">
                            <input type="date" name="fecha_desde" class="modern-date-input" placeholder="Desde">
                            <span class="date-separator">‚Äî</span>
                            <input type="date" name="fecha_hasta" class="modern-date-input" placeholder="Hasta">
                        </div>
                    </div>

                    <!-- Bot√≥n PDF -->
                    <button type="submit" class="modern-btn btn-pdf">
                        <i class="fas fa-file-pdf"></i>
                        <span>Generar Reporte PDF</span>
                    </button>
                </form>

                <!-- Bot√≥n Excel -->
                <form method="POST" action="{{ url_for('docente.generar_reporte_excel') }}" class="excel-form">
                    <input type="hidden" name="filtro_tipo" value="completo">
                    <input type="hidden" name="programa_id" id="programa_id_excel">
                    <input type="hidden" name="grupo_id" id="grupo_id_excel">
                    <input type="hidden" name="estado" id="estado_excel">
                    <input type="hidden" name="fecha_desde" id="fecha_desde_excel">
                    <input type="hidden" name="fecha_hasta" id="fecha_hasta_excel">

                    <button type="submit" class="modern-btn btn-excel">
                        <i class="fas fa-file-excel"></i>
                        <span>Generar Reporte Excel</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Info Panel -->
    <div class="reports-info-panel">
        <div class="modern-card">
            <div class="modern-card-header">
                <div class="card-header-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <h3 class="card-header-title">Tipos de Reportes Disponibles</h3>
            </div>
            <div class="modern-card-body">
                <div class="report-types-list">
                    <div class="report-type-item">
                        <div class="report-icon report-icon-blue">
                            <i class="fas fa-flag"></i>
                        </div>
                        <div class="report-content">
                            <h4>Matr√≠culas por Estado</h4>
                            <p>Genera un reporte detallado de todas las matr√≠culas agrupadas por su estado actual</p>
                        </div>
                    </div>

                    <div class="report-type-item">
                        <div class="report-icon report-icon-green">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="report-content">
                            <h4>Matr√≠culas por Programa</h4>
                            <p>Visualiza las matr√≠culas organizadas por programa de formaci√≥n</p>
                        </div>
                    </div>

                    <div class="report-type-item">
                        <div class="report-icon report-icon-purple">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="report-content">
                            <h4>Matr√≠culas por Grupo</h4>
                            <p>Reporte espec√≠fico de matr√≠culas por grupo acad√©mico</p>
                        </div>
                    </div>

                    <div class="report-type-item">
                        <div class="report-icon report-icon-teal">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="report-content">
                            <h4>Estado de Documentos</h4>
                            <p>An√°lisis detallado del estado de validaci√≥n de documentos</p>
                        </div>
                    </div>

                    <div class="report-type-item">
                        <div class="report-icon report-icon-indigo">
                            <i class="fas fa-list-check"></i>
                        </div>
                        <div class="report-content">
                            <h4>Reporte Completo</h4>
                            <p>Reporte comprehensivo con toda la informaci√≥n de matr√≠culas</p>
                        </div>
                    </div>

                    <div class="report-type-item special-sofia">
                        <div class="report-icon report-icon-orange">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <div class="report-content">
                            <h4>Formato SENA (SOFIA Plus)</h4>
                            <p>Archivo Excel para carga masiva en plataforma SOFIA Plus del SENA. Incluye tipo y n√∫mero de documento, c√≥digo de ficha y tipo de poblaci√≥n.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Sincronizar filtros entre formularios
document.getElementById('reporteForm').addEventListener('submit', function() {
    syncFilters();
});

document.querySelectorAll('#programa_id, #grupo_id, #estado, input[name="fecha_desde"], input[name="fecha_hasta"]').forEach(input => {
    input.addEventListener('change', syncFilters);
});

function syncFilters() {
    document.getElementById('programa_id_excel').value = document.getElementById('programa_id').value;
    document.getElementById('grupo_id_excel').value = document.getElementById('grupo_id').value;
    document.getElementById('estado_excel').value = document.getElementById('estado').value;
    document.getElementById('fecha_desde_excel').value = document.querySelector('input[name="fecha_desde"]').value;
    document.getElementById('fecha_hasta_excel').value = document.querySelector('input[name="fecha_hasta"]').value;
}
</script>

<style>
/* Modern Reports Styles */
:root {
    --reports-green: #39A900;
    --reports-green-dark: #2D8700;
    --reports-blue: #4299e1;
    --reports-orange: #f59e0b;
    --reports-purple: #9f7aea;
    --reports-teal: #14b8a6;
    --reports-indigo: #6366f1;
}

/* Modern Header */
.reports-modern-header {
    background: linear-gradient(135deg, var(--reports-green) 0%, var(--reports-green-dark) 100%);
    border-radius: 20px;
    padding: 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(57, 169, 0, 0.2);
}

.reports-header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.reports-header-left {
    flex: 1;
}

.reports-breadcrumb {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    font-size: 0.9rem;
}

.breadcrumb-link {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: color 0.2s;
}

.breadcrumb-link:hover {
    color: white;
}

.breadcrumb-separator {
    color: rgba(255, 255, 255, 0.6);
}

.breadcrumb-current {
    color: white;
    font-weight: 500;
}

.reports-main-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    margin: 0 0 0.5rem 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.reports-subtitle {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.95);
    margin: 0;
}

.reports-header-icon {
    font-size: 5rem;
    color: rgba(255, 255, 255, 0.15);
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

/* Stats Grid */
.reports-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.reports-stat-card {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.reports-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--stat-color);
}

.reports-stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
}

.stat-blue { --stat-color: var(--reports-blue); }
.stat-orange { --stat-color: var(--reports-orange); }
.stat-green { --stat-color: var(--reports-green); }
.stat-purple { --stat-color: var(--reports-purple); }

.stat-icon-wrapper {
    flex-shrink: 0;
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
    background: var(--stat-color);
}

.stat-info {
    flex: 1;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #1a202c;
    line-height: 1;
}

.stat-label {
    font-size: 0.875rem;
    color: #718096;
    margin-top: 0.25rem;
}

.stat-trend {
    font-size: 1.5rem;
    color: var(--stat-color);
    opacity: 0.3;
}

/* Content Grid */
.reports-content-grid {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

@media (max-width: 1024px) {
    .reports-content-grid {
        grid-template-columns: 1fr;
    }
}

/* Modern Card */
.modern-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    overflow: hidden;
}

.modern-card-header {
    background: linear-gradient(135deg, var(--reports-green) 0%, var(--reports-green-dark) 100%);
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.card-header-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.card-header-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: white;
    margin: 0;
}

.modern-card-body {
    padding: 1.5rem;
}

/* Form Styles */
.modern-form-group {
    margin-bottom: 1.25rem;
}

.modern-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
}

.label-icon {
    color: var(--reports-green);
}

.modern-select,
.modern-date-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 0.95rem;
    transition: all 0.2s;
    background: white;
}

.modern-select:focus,
.modern-date-input:focus {
    outline: none;
    border-color: var(--reports-green);
    box-shadow: 0 0 0 3px rgba(57, 169, 0, 0.1);
}

.date-range-inputs {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.date-separator {
    color: #718096;
    font-weight: 600;
}

/* Buttons */
.modern-btn {
    width: 100%;
    padding: 1rem 1.5rem;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.btn-pdf {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
    color: white;
}

.btn-pdf:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(229, 62, 62, 0.4);
}

.btn-excel {
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
    color: white;
}

.btn-excel:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(56, 161, 105, 0.4);
}

.excel-form {
    margin: 0;
}

/* Report Types List */
.report-types-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.report-type-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    background: #f7fafc;
    transition: all 0.3s ease;
}

.report-type-item:hover {
    background: #edf2f7;
    transform: translateX(4px);
}

.special-sofia {
    background: linear-gradient(135deg, #fff5f2 0%, #ffe8df 100%);
    border: 2px solid #FF6B35;
}

.report-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    flex-shrink: 0;
}

.report-icon-blue { background: linear-gradient(135deg, var(--reports-blue) 0%, #3182ce 100%); }
.report-icon-green { background: linear-gradient(135deg, var(--reports-green) 0%, var(--reports-green-dark) 100%); }
.report-icon-purple { background: linear-gradient(135deg, var(--reports-purple) 0%, #805ad5 100%); }
.report-icon-teal { background: linear-gradient(135deg, var(--reports-teal) 0%, #0d9488 100%); }
.report-icon-indigo { background: linear-gradient(135deg, var(--reports-indigo) 0%, #4f46e5 100%); }
.report-icon-orange { background: linear-gradient(135deg, #FF6B35 0%, #ff5722 100%); }

.report-content h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #1a202c;
    margin: 0 0 0.25rem 0;
}

.report-content p {
    font-size: 0.875rem;
    color: #4a5568;
    margin: 0;
    line-height: 1.5;
}

.special-sofia .report-content h4 {
    color: #FF6B35;
}

/* Responsive */
@media (max-width: 768px) {
    .reports-modern-header {
        padding: 1.5rem;
    }

    .reports-main-title {
        font-size: 1.75rem;
    }

    .reports-header-icon {
        font-size: 3rem;
    }

    .reports-stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
    }

    .stat-value {
        font-size: 1.5rem;
    }

    .date-range-inputs {
        flex-direction: column;
    }
}
</style>

{% endblock %}
